!function(){!function(){function t(t,i){for(var n in i)t[n]=i[n];return t}function i(t,i){if(-1==i.indexOf("."))return t[i];i=i.split(".");for(var n=0;n<i.length-1;n++)if(t=t[i[n]],!t)return"";return t[i[n]]}function n(t){return f.call(t).slice(8,-1)}function o(t,i){if("function"==typeof t){var n=l.call(arguments,2);setTimeout(function(){t.apply(i,n)},0)}}function e(t,i,e,s,u){var r,a,c;if("data"in i){var f=n(i.data);"String"===f?a="application/json":"FormData"===f?r=i.method||"POST":(r=i.method||"POST",a="application/json",i.data=JSON.stringify(i.data))}else r=i.method||"GET";if("function"!=typeof s&&(u||(u=s),s=null),!t.apikey)return o(s,u,"API key not set",null);var l=new XMLHttpRequest;l.open(r,t.protocol+i.url),c=i.responseType||"json","json"!=c&&(l.responseType=c,"blob"==c&&"blob"!=l.responseType&&(l.responseType="arraybuffer")),a&&l.setRequestHeader("Content-Type",a),l.setRequestHeader("Authorization","Hoist "+t.apikey),l.withCredentials=!0,l.onreadystatechange=function(){if(4===l.readyState)if(l.status>=200&&l.status<400){var t=l.response||l.responseText,i=n(t);"String"===i&&"json"===c?t=JSON.parse(t):"ArrayBuffer"===i&&"blob"===c&&(t=new Blob([t])),e&&e.call(u,t,l)}else s&&s.call(u,l.statusText,l)},l.send(i.data)}function s(t,i){this.type=i,this.url="data.hoi.io/"+i,this.hoist=t}function u(t,i){var n=this.items={};for(var o in i){var e,s={key:o,path:i[o],requires:[]};for("?"==s.path[s.path.length-1]&&(s.path=s.path.slice(0,-1),s.optional=!0);null!==(e=h.exec(s.path));){var u=e[1].indexOf(".");u>-1&&s.requires.push(e[1].slice(0,u))}n[o]=s}this.hoist=t}function r(t,i,n){this.hoist=t,this.url="proxy.hoi.io/"+i,this.token=n}function a(){var i=t(function(t){return"Object"===n(t)?new u(i,t):i._managers[t]||(i._managers[t]=new s(i,t))},p);return i.bucket=t(function(t,n,o,e,s){var u=typeof t;if("function"===u)i.bucket.status(t,n,o);else if("string"===u&&"object"==typeof n)i.bucket.post(t,n,o,e,s);else if("string"===u||null===t)i.bucket.set(t,n,o,e);else{if("object"!==u)return i._bucket;i.bucket.meta(t,n,o,e)}},g),i.bucket._hoist=i,i}var c,f=Object.prototype.toString,l=Array.prototype.splice;t(s.prototype,{get:function(t,i,n,o){"function"==typeof t&&(o=n,n=i,i=t,t=null),t?e(this.hoist._configs,{url:this.url+"/"+t},i,n,o):e(this.hoist._configs,{url:this.url},i,n,o)},post:function(t,i,o,s,u){"object"==typeof t&&null!==t&&(u=s,s=o,o=i,i=t,t=i._id);var r="Array"===n(i)&&1===i.length;t?e(this.hoist._configs,{url:this.url+"/"+t,data:i},o,s,u):e(this.hoist._configs,{url:this.url,data:i},o&&function(t,i){o.call(this,r?[t]:t,i)},s,u)},clear:function(t,i,n){e(this.hoist._configs,{url:this.url,method:"DELETE"},t,i,n)},remove:function(t,i,n,s){return t?void e(this.hoist._configs,{url:this.url+"/"+t,method:"DELETE"},i,n,s):o(n,s,"Cannot remove model with empty id",null)}});var h=/\[([^\]]+)\]/g;t(u.prototype,{get:function(n,o,e,s){function u(t){return function(i){l[t]=i,delete f[t],a()}}function r(t){return function(i,n){f[t].optional?u(t)(null):(c=!0,e&&e.call(s,t+": "+i,n))}}function a(){if(!c){var t=0;t:for(var e in f){var a=f[e];if(!p[e]){for(var d=0;d<a.requires.length;d++)if(a.requires[d]in f)continue t;var y=a.path.replace(h,function(t,o){return o.indexOf(".")>-1?i(l,o):n[o]||""}),_=y.indexOf(" ");_>-1?(p[a.key]=g(y.slice(0,_))).get(y.slice(_+1),u(a.key),r(a.key)):(p[a.key]=g(y)).get(u(a.key),r(a.key))}t++}t||o.call(s,l,p)}}var c,f={},l={},p={},g=this.hoist;"function"==typeof n?(s=e,e=o,o=n,n={}):"string"==typeof n&&(n={id:n}),t(f,this.items),"function"!=typeof e&&(s||(s=e),e=null),a()}}),t(r.prototype,{authorize:function(i,n){i=t({url:window.location.href,error:function(){},success:function(){},redirect:function(t){window.location=t}},i);var o=function(t){return t.redirect?void(i.redirect&&i.redirect.call(this,t.redirect)):void(i.success&&i.success.apply(this,arguments))};e(this.hoist._configs,{url:this.url+"/connect",data:{return_url:i.url}},o,i.error,n)},get:function(t,i,n,o){"/"!==t[0]&&(t="/"+t),e(this.hoist._configs,{url:this.url+t,token:this.token},i,n,o)},post:function(t,i,n,o,s){"/"!==t[0]&&(t="/"+t),e(this.hoist._configs,{url:this.url+t,data:i,token:this.token},n,o,s)},put:function(t,i,n,o,s){"/"!==t[0]&&(t="/"+t),e(this.hoist._configs,{url:this.url+t,data:i,method:"PUT",token:this.token},n,o,s)},remove:function(t,i,n,o,s){"function"==typeof i&&(s=o,o=n,n=i,i=null),"/"!==t[0]&&(t="/"+t),e(this.hoist._configs,{url:this.url+t,data:i,method:"DELETE",token:this.token},n,o,s)}});var p={apiKey:function(t){return this.config("apikey",t)},get:function(t,i,n,o,e){this(t).get(i,n,o,e)},post:function(t,i,n,o,e,s){this(t).post(i,n,o,e,s)},clear:function(t,i,n,o){this(t).clear(i,n,o)},remove:function(t,i,n,o,e){this(t).remove(i,n,o,e)},config:function(t,i){if(i===c){var n=typeof t;if("string"===n)return this._configs[t];if("object"===n)for(var o in t)this._configs[o.toLowerCase()]=t[o]}else this._configs[t.toLowerCase()]=i},status:function(t,i,n){var o=this;"function"!=typeof i&&(n||(n=i),i=null),e(this._configs,{url:"auth.hoi.io/status"},function(i){o._user=i,t&&t.apply(this,arguments)},function(){o._user=null,i&&i.apply(this,arguments)},n)},signup:function(t,i,n,o){var s=this;"object"==typeof t&&e(this._configs,{url:"auth.hoi.io/user",data:t},function(t){s._user=t,i&&i.apply(this,arguments)},n,o)},login:function(t,i,n,o){var s=this;"object"==typeof t&&e(this._configs,{url:"auth.hoi.io/login",data:t},function(t){s._user=t,i&&i.apply(this,arguments)},n,o)},logout:function(t,i,n){var o=this;e(this._configs,{url:"auth.hoi.io/logout",method:"POST"},function(){o._user=null,t&&t.apply(this,arguments)},i,n)},user:function(){return this._user&&t({},this._user)},notify:function(t,i,n,o,s){"object"==typeof t&&(s=o,o=n,n=i,i=t.data,t=t.id),"object"==typeof i&&e(this._configs,{url:"notify.hoi.io/notification/"+t,data:i},n,o,s)},file:function(t,i,o,s,u){i.jquery&&(i=i[0]);var r,a=n(i);if("File"===a)r=new FormData,r.append("file",i);else if("FormData"===a)r=i;else{if("HTMLInputElement"!==a)return"Function"===a?(u=s,s=o,o=i,void e(this._configs,{url:"file.hoi.io/"+t,responseType:"blob"},o,s,u)):"Undefined"===a?void e(this._configs,{url:"file.hoi.io/"+t,responseType:"blob"},o,s,u):void 0;if(i=i.files&&i.files[0],!i)return!1;r=new FormData,r.append("file",i)}e(this._configs,{url:"file.hoi.io/"+t,data:r},o,s,u)},connector:function(t,i){return new r(this,t,i)},clone:function(){var i=t(a(),{_configs:t({},this._configs),_user:null,_bucket:null,_managers:{}});return i}},g={status:function(t,i,n){var o=this._hoist;"function"!=typeof i&&(n||(n=i),i=null),e(this._hoist._configs,{url:"auth.hoi.io/bucket/current"},function(i){o._bucket=i,t&&t.apply(this,arguments)},function(){o._bucket=null,i&&i.apply(this,arguments)},n)},post:function(t,i,n,o,s){"object"!=typeof i&&(s=o,o=n,n=i,i=null),e(this._hoist._configs,{url:"auth.hoi.io/bucket/"+t,data:i},n,o,s)},meta:function(t,i,n,s,u){var r=this._hoist;if("string"!=typeof t){if(u=s,s=n,n=i,i=t,!r._bucket)return o(s,u,"No bucket to post metadata against",null);t=r._bucket.key,e(r._configs,{url:"auth.hoi.io/bucket/"+t+"/meta",data:i},function(t){r._bucket=t,n&&n.apply(this,arguments)},s,u)}else e(r._configs,{url:"auth.hoi.io/bucket/"+t+"/meta",data:i},n,s,u)},set:function(t,i,n,o){var s=this._hoist;e(this._hoist._configs,{url:"auth.hoi.io/bucket/current/"+(t||"default"),method:"POST"},function(n){s._bucket=t?n:null,i&&i.apply(this,arguments)},n,o)},list:function(t,i,n){e(this._hoist._configs,{url:"auth.hoi.io/buckets"},t,i,n)},invite:function(t,i,n,o){e(this._hoist._configs,{url:"auth.hoi.io/invite",data:t},i,n,o)}},d=t(a(),{_configs:{protocol:"https://"},_user:null,_bucket:null,_managers:{}});"function"==typeof define&&define.amd?define("Hoist",[],function(){return d}):"object"==typeof window&&"object"==typeof window.document?window.Hoist=d:"object"==typeof module&&"object"==typeof module.exports&&(module.exports=d)}()}();
//# sourceMappingURL=hoist-min.js.map