!function(){!function(){function t(t,i){for(var e in i)t[e]=i[e];return t}function i(t,i){if(-1==i.indexOf("."))return t[i];i=i.split(".");for(var e=0;e<i.length-1;e++)if(t=t[i[e]],!t)return"";return t[i[e]]}function e(t){return f.call(t).slice(8,-1)}function n(t,i){if("function"==typeof t){var e=c.call(arguments,2);setTimeout(function(){t.apply(i,e)},0)}}function o(t,i,o,s,u){var r,a,f;if("data"in i){var c=e(i.data);"String"===c?a="application/json":"FormData"===c?r=i.method||"POST":(r=i.method||"POST",a="application/json",i.data=JSON.stringify(i.data))}else r=i.method||"GET";if("function"!=typeof s&&(u||(u=s),s=null),!t.apikey)return n(s,u,"API key not set",null);var l=new XMLHttpRequest;l.open(r,t.protocol+i.url),f=i.responseType||"json","json"!=f&&(l.responseType=f,"blob"==f&&"blob"!=l.responseType&&(l.responseType="arraybuffer")),a&&l.setRequestHeader("Content-Type",a),l.setRequestHeader("Authorization","Hoist "+t.apikey),l.withCredentials=!0,l.onreadystatechange=function(){if(4===l.readyState)if(l.status>=200&&l.status<400){var t=l.response||l.responseText,i=e(t);"String"===i&&"json"===f?t=JSON.parse(t):"ArrayBuffer"===i&&"blob"===f&&(t=new Blob([t])),o&&o.call(u,t,l)}else s&&s.call(u,l.statusText,l)},l.send(i.data)}function s(t,i){this.type=i,this.url="data.hoi.io/"+i,this.hoist=t}function u(t,i){var e=this.items={};for(var n in i){var o,s={key:n,path:i[n],requires:[]};for("?"==s.path[s.path.length-1]&&(s.path=s.path.slice(0,-1),s.optional=!0);null!==(o=l.exec(s.path));){var u=o[1].indexOf(".");u>-1&&s.requires.push(o[1].slice(0,u))}e[n]=s}this.hoist=t}function r(){var i=t(function(t){return"Object"===e(t)?new u(i,t):i._managers[t]||(i._managers[t]=new s(i,t))},h);return i.bucket=t(function(t,e,n,o,s){var u=typeof t;if("function"===u)i.bucket.status(t,e,n);else if("string"===u&&"object"==typeof e)i.bucket.post(t,e,n,o,s);else if("string"===u||null===t)i.bucket.set(t,e,n,o);else{if("object"!==u)return i._bucket;i.bucket.meta(t,e,n,o)}},p),i.bucket._hoist=i,i}var a,f=Object.prototype.toString,c=Array.prototype.splice;t(s.prototype,{get:function(t,i,e,n){"function"==typeof t&&(n=e,e=i,i=t,t=null),t?o(this.hoist._configs,{url:this.url+"/"+t},i,e,n):o(this.hoist._configs,{url:this.url},i,e,n)},post:function(t,i,n,s,u){"object"==typeof t&&null!==t&&(u=s,s=n,n=i,i=t,t=i._id);var r="Array"===e(i)&&1===i.length;t?o(this.hoist._configs,{url:this.url+"/"+t,data:i},n,s,u):o(this.hoist._configs,{url:this.url,data:i},n&&function(t,i){n.call(this,r?[t]:t,i)},s,u)},clear:function(t,i,e){o(this.hoist._configs,{url:this.url,method:"DELETE"},t,i,e)},remove:function(t,i,e,s){return t?void o(this.hoist._configs,{url:this.url+"/"+t,method:"DELETE"},i,e,s):n(e,s,"Cannot remove model with empty id",null)}});var l=/\[([^\]]+)\]/g;t(u.prototype,{get:function(e,n,o,s){function u(t){return function(i){h[t]=i,delete c[t],a()}}function r(t){return function(i,e){c[t].optional?u(t)(null):(f=!0,o&&o.call(s,t+": "+i,e))}}function a(){if(!f){var t=0;t:for(var o in c){var a=c[o];if(!p[o]){for(var y=0;y<a.requires.length;y++)if(a.requires[y]in c)continue t;var d=a.path.replace(l,function(t,n){return n.indexOf(".")>-1?i(h,n):e[n]||""}),_=d.indexOf(" ");_>-1?(p[a.key]=g(d.slice(0,_))).get(d.slice(_+1),u(a.key),r(a.key)):(p[a.key]=g(d)).get(u(a.key),r(a.key))}t++}t||n.call(s,h,p)}}var f,c={},h={},p={},g=this.hoist;"function"==typeof e?(s=o,o=n,n=e,e={}):"string"==typeof e&&(e={id:e}),t(c,this.items),"function"!=typeof o&&(s||(s=o),o=null),a()}});var h={apiKey:function(t){return this.config("apikey",t)},get:function(t,i,e,n,o){this(t).get(i,e,n,o)},post:function(t,i,e,n,o,s){this(t).post(i,e,n,o,s)},clear:function(t,i,e,n){this(t).clear(i,e,n)},remove:function(t,i,e,n,o){this(t).remove(i,e,n,o)},config:function(t,i){if(i===a){var e=typeof t;if("string"===e)return this._configs[t];if("object"===e)for(var n in t)this._configs[n.toLowerCase()]=t[n]}else this._configs[t.toLowerCase()]=i},status:function(t,i,e){var n=this;"function"!=typeof i&&(e||(e=i),i=null),o(this._configs,{url:"auth.hoi.io/status"},function(i){n._user=i,t&&t.apply(this,arguments)},function(){n._user=null,i&&i.apply(this,arguments)},e)},signup:function(t,i,e,n){var s=this;"object"==typeof t&&o(this._configs,{url:"auth.hoi.io/user",data:t},function(t){s._user=t,i&&i.apply(this,arguments)},e,n)},login:function(t,i,e,n){var s=this;"object"==typeof t&&o(this._configs,{url:"auth.hoi.io/login",data:t},function(t){s._user=t,i&&i.apply(this,arguments)},e,n)},logout:function(t,i,e){var n=this;o(this._configs,{url:"auth.hoi.io/logout",method:"POST"},function(){n._user=null,t&&t.apply(this,arguments)},i,e)},user:function(){return this._user&&t({},this._user)},notify:function(t,i,e,n,s){"object"==typeof t&&(s=n,n=e,e=i,i=t.data,t=t.id),"object"==typeof i&&o(this._configs,{url:"notify.hoi.io/notification/"+t,data:i},e,n,s)},file:function(t,i,n,s,u){i.jquery&&(i=i[0]);var r,a=e(i);if("File"===a)r=new FormData,r.append("file",i);else if("FormData"===a)r=i;else{if("HTMLInputElement"!==a)return"Function"===a?(u=s,s=n,n=i,void o(this._configs,{url:"file.hoi.io/"+t,responseType:"blob"},n,s,u)):"Undefined"===a?void o(this._configs,{url:"file.hoi.io/"+t,responseType:"blob"},n,s,u):void 0;if(i=i.files&&i.files[0],!i)return!1;r=new FormData,r.append("file",i)}o(this._configs,{url:"file.hoi.io/"+t,data:r},n,s,u)},clone:function(){var i=t(r(),{_configs:t({},this._configs),_user:null,_bucket:null,_managers:{}});return i}},p={status:function(t,i,e){var n=this._hoist;"function"!=typeof i&&(e||(e=i),i=null),o(this._hoist._configs,{url:"auth.hoi.io/bucket/current"},function(i){n._bucket=i,t&&t.apply(this,arguments)},function(){n._bucket=null,i&&i.apply(this,arguments)},e)},post:function(t,i,e,n,s){"object"!=typeof i&&(s=n,n=e,e=i,i=null),o(this._hoist._configs,{url:"auth.hoi.io/bucket/"+t,data:i},e,n,s)},meta:function(t,i,e,s,u){var r=this._hoist;if("string"!=typeof t){if(u=s,s=e,e=i,i=t,!r._bucket)return n(s,u,"No bucket to post metadata against",null);t=r._bucket.key,o(r._configs,{url:"auth.hoi.io/bucket/"+t+"/meta",data:i},function(t){r._bucket=t,e&&e.apply(this,arguments)},s,u)}else o(r._configs,{url:"auth.hoi.io/bucket/"+t+"/meta",data:i},e,s,u)},set:function(t,i,e,n){var s=this._hoist;o(this._hoist._configs,{url:"auth.hoi.io/bucket/current/"+(t||"default"),method:"POST"},function(e){s._bucket=t?e:null,i&&i.apply(this,arguments)},e,n)},list:function(t,i,e){o(this._hoist._configs,{url:"auth.hoi.io/buckets"},t,i,e)},invite:function(t,i,e,n){o(this._hoist._configs,{url:"auth.hoi.io/invite",data:t},i,e,n)}},g=t(r(),{_configs:{protocol:"https://"},_user:null,_bucket:null,_managers:{}});"function"==typeof define&&define.amd?define("Hoist",[],function(){return g}):"object"==typeof window&&"object"==typeof window.document?window.Hoist=g:"object"==typeof module&&"object"==typeof module.exports&&(module.exports=g)}()}();
//# sourceMappingURL=hoist-min.js.map