!function(){!function(){function t(t,e){for(var i in e)t[i]=e[i];return t}function e(t,e){for(var i in e)for(var n=i.split(" "),r=0;r<n.length;r++)t[n[r]]=e[i]}function i(t,e){if(-1==e.indexOf("."))return t[e];e=e.split(".");for(var i=0;i<e.length-1;i++)if(t=t[e[i]],!t)return"";return t[e[i]]}function n(t){return y.call(t).slice(8,-1)}function r(t,e){var i=new s,n=d.call(arguments,2);return i.reject(n[0]),"function"==typeof t&&t.apply(e,n),i}function s(){this.cbs=[]}function o(t,e,i,o,u){var c,h,f;if("data"in e){var a=n(e.data);"String"===a?h="application/json":"FormData"===a?c=e.method||"POST":(c=e.method||"POST",h="application/json",e.data=JSON.stringify(e.data))}else c=e.method||"GET";if("function"!=typeof o&&(u||(u=o),o=null),t&&!t.apikey)return r(o,u,"API key not set",null);var l=new XMLHttpRequest;l.open(c,t?t.protocol+e.url:e.url),f=e.responseType||"json","json"!=f&&(l.responseType=f,"blob"==f&&"blob"!=l.responseType&&(l.responseType="arraybuffer")),h&&l.setRequestHeader("Content-Type",h),t&&l.setRequestHeader("Authorization","Hoist "+t.apikey),e.bucket&&l.setRequestHeader("x-bucket-key",e.bucket),e.token&&l.setRequestHeader("OAuth","Token "+e.token),l.withCredentials=!0;var p=new s;return l.onreadystatechange=function(){if(4===l.readyState)if(l.status>=200&&l.status<400){var t=l.response||l.responseText,r=n(t);"String"===r&&"json"===f?t=JSON.parse(t):"ArrayBuffer"===r&&"blob"===f&&(t=new Blob([t])),e.process&&(t=e.process(t)),i&&i.call(u,t,l),p.resolve(t)}else{var s=l.statusText;e.processError&&(s=e.processError(s)),o&&o.call(u,s,l),p.reject(s)}},l.send(e.data),p}function u(t,e,i){this.type=e,this.url="data.hoi.io/"+e,this.hoist=t,this.bucket=i}function c(t,e){this.dm=t,this.query=e}function h(t,e){this.qm=t,this.key=e}function f(t,e,i){var n=this.items={};for(var r in e){var s,o={key:r,path:e[r],requires:[]};for("?"==o.path[o.path.length-1]&&(o.path=o.path.slice(0,-1),o.optional=!0);null!==(s=k.exec(o.path));){var u=s[1].indexOf(".");u>-1&&o.requires.push(s[1].slice(0,u))}n[r]=o}this.hoist=i?t.use(i):t}function a(t,e,i){this.hoist=t,this.url="proxy.hoi.io/"+e,this.token=i}function l(){var e=t(function(t,i){return"Object"===n(t)?new f(e,t,i):new u(e,t,i)},b);return e.bucket=t(function(t,i,n,r,s){var o=typeof t;if("function"===o)e.bucket.status(t,i,n);else if("string"===o&&"object"==typeof i)e.bucket.post(t,i,n,r,s);else if("string"===o||null===t)e.bucket.set(t,i,n,r);else{if("object"!==o)return e._bucket;e.bucket.meta(t,i,n,r)}},g),e.bucket._hoist=e,e}var p,y=Object.prototype.toString,d=Array.prototype.splice;t(s.prototype,{resolve:function(t){if(!this.state){var e,i=t&&t.then,n=this;if("function"==typeof i)try{i.call(t,function(t){e||(e=!0,n.resolve(t))},function(t){e||(e=!0,n.reject(t))})}catch(r){e||(e=!0,this.reject(r))}else{this.state=1,this.value=t;for(var s=0;s<this.cbs.length;s++){var o=this.cbs[s][0],u=this.cbs[s][2];try{u.resolve("function"==typeof o?o(t):t)}catch(r){u.reject(r)}}this.cbs=null}}},reject:function(t){if(!this.state){this.state=-1,this.value=t;for(var e=0;e<this.cbs.length;e++){var i=this.cbs[e][1],n=this.cbs[e][2];try{"function"==typeof i?n.resolve(i(t)):n.reject(t)}catch(r){n.reject(r)}}this.cbs=null}},then:function(t,e){var i=new s;if(this.state){try{1==this.state?i.resolve("function"==typeof t?t(this.value):this.value):"function"==typeof e?i.resolve(e(this.value)):i.reject(this.value)}catch(n){i.reject(n)}}else this.cbs.push([t,e,i]);return i}}),t(u.prototype,{get:function(t,e,i,n){return"function"==typeof t&&(n=i,i=e,e=t,t=null),t?o(this.hoist._configs,{url:this.url+"/"+t,bucket:this.bucket},e,i,n):o(this.hoist._configs,{url:this.url,bucket:this.bucket},e,i,n)},query:function(t){return new c(this,{q:t})},where:function(t,e){return new c(this,{}).where(t,e)},limit:function(t){return new c(this,{limit:t})},skip:function(t){return new c(this,{skip:t})},sortBy:function(){var t=new c(this,{});return t._sort(!1,arguments)},post:function(t,e,i,r,s){"object"==typeof t&&null!==t&&(s=r,r=i,i=e,e=t,t=e._id);var u="Array"===n(e)&&1===e.length;return t?o(this.hoist._configs,{url:this.url+"/"+t,bucket:this.bucket,data:e},i,r,s):o(this.hoist._configs,{url:this.url,bucket:this.bucket,data:e,process:function(t){return u?[t]:t}},i,r,s)},clear:function(t,e,i){return o(this.hoist._configs,{url:this.url,bucket:this.bucket,method:"DELETE"},t,e,i)},remove:function(t,e,i,n){return t?o(this.hoist._configs,{url:this.url+"/"+t,bucket:this.bucket,method:"DELETE"},e,i,n):r(i,n,"Cannot remove model with empty id",null)},use:function(t){return this.hoist(this.type,t)}}),t(c.prototype,{get:function(t,e,i){var n=[];return this.query.q&&n.push("q="+encodeURIComponent(JSON.stringify(this.query.q))),this.query.limit&&n.push("limit="+this.query.limit),this.query.skip&&n.push("skip="+this.query.skip),this.query.sort&&n.push("sort="+encodeURIComponent(JSON.stringify(this.query.sort))),o(this.dm.hoist._configs,{url:this.dm.url+"?"+n.join("&"),bucket:this.dm.bucket},t,e,i)},where:function(e,i){if("string"==typeof e)return i===p?new h(this,e):this._where(e,i);var n=t({},this.query);return n.q=n.q?t({},n.q):{},t(n.q,e),new c(this.dm,n)},_where:function(e,i){var n=t({},this.query);return n.q=n.q?t({},n.q):{},n.q[e]=i,new c(this.dm,n)},_whereAnd:function(e,i,n){var r=t({},this.query);return r.q=r.q?t({},r.q):{},r.q[e]=r.q[e]?t({},r.q[e]):{},r.q[e][i]=n,new c(this.dm,r)},limit:function(e){var i=t({},this.query);return i.limit=e,new c(this.dm,i)},skip:function(e){var i=t({},this.query);return i.skip=e,new c(this.dm,i)},_sort:function(e,i){for(var n=e&&this.query.sort&&this.query.sort.slice()||[],r=0;r<i.length;r++)n.push(" asc"==i[r].slice(-4).toLowerCase()?[i[r].slice(0,-4),1]:" desc"==i[r].slice(-5).toLowerCase()?[i[r].slice(0,-5),-1]:[i[r],1]);var s=t({},this.query);return s.sort=n,new c(this.dm,s)},sortBy:function(){return this._sort(!1,arguments)},thenBy:function(){return this._sort(!0,arguments)},use:function(t){return new c(this.dm.use(t),this.query)}}),e(h.prototype,{"eq is equals":function(t){return this.qm=this.qm._where(this.key,t),this},"neq ne isnt notEquals":function(t){return this.qm=this.qm._whereAnd(this.key,"$ne",t),this},"gt greaterThan":function(t){return this.qm=this.qm._whereAnd(this.key,"$gt",t),this},"gte ge atLeast":function(t){return this.qm=this.qm._whereAnd(this.key,"$gte",t),this},"lt lessThan":function(t){return this.qm=this.qm._whereAnd(this.key,"$lt",t),this},"lte le atMost":function(t){return this.qm=this.qm._whereAnd(this.key,"$lte",t),this},"elem in":function(t){return this.qm=this.qm._whereAnd(this.key,"$in",t),this},"nelem nin notIn notElem":function(t){return this.qm=this.qm._whereAnd(this.key,"$nin",t),this},exists:function(){return this.qm=this.qm._whereAnd(this.key,"$exists",!0),this}}),t(h.prototype,{where:function(t,e){return this.qm.where(t,e)},limit:function(t){return this.qm.limit(t)},skip:function(t){return this.qm.skip(t)},sort:function(){return this.qm.sort.apply(this.qm,arguments)},sortBy:function(){return this.qm._sort(!1,arguments)},thenBy:function(){return this.qm._sort(!0,arguments)},use:function(t){return this.qm.use(t)},get:function(t,e,i){return this.qm.get(t,e,i)}});var k=/\[([^\]]+)\]/g;t(f.prototype,{get:function(e,n,r,o){function u(t){return function(e){l[t]=e,delete a[t],h()}}function c(t){return function(e,i){a[t].optional?u(t)(null):(f=!0,e=t+": "+e,r&&r.call(o,e,i),d.reject(e))}}function h(){if(!f){var t=0;t:for(var r in a){var s=a[r];if(!p[r]){for(var h=0;h<s.requires.length;h++)if(s.requires[h]in a)continue t;var m=s.path.replace(k,function(t,n){return n.indexOf(".")>-1?i(l,n):e[n]||""}),b=m.indexOf(" ");b>-1?(p[s.key]=y(m.slice(0,b))).get(m.slice(b+1),u(s.key),c(s.key)):(p[s.key]=y(m)).get(u(s.key),c(s.key))}t++}t||(n&&n.call(o,l,p),d.resolve(l))}}var f,a={},l={},p={},y=this.hoist,d=new s;return"function"==typeof e?(o=r,r=n,n=e,e={}):"string"==typeof e&&(e={id:e}),t(a,this.items),"function"!=typeof r&&(o||(o=r),r=null),h(),d}});var m={get:function(t,e,i,n,r){return this.hoist(t,this.bucket).get(e,i,n,r)},post:function(t,e,i,n,r){return this.hoist(t,this.bucket).post(e,data,i,n,r)},clear:function(t,e,i,n){return this.hoist(t,this.bucket).clear(e,i,n)},remove:function(t,e,i,n,r){return this.hoist(t,this.bucket).remove(e,i,n,r)},meta:function(t,e,i,n){return this.hoist.bucket.meta(this.bucket,t,e,i,n)},invite:function(t,e,i,n){return this.hoist.bucket.invite(this.bucket,t,e,i,n)},enter:function(t,e,i){return this.hoist.bucket.set(this.bucket,t,e,i)}},b={apiKey:function(t){return this.config("apikey",t)},get:function(t,e,i,n,r){return this(t).get(e,i,n,r)},post:function(t,e,i,n,r,s){return this(t).post(e,i,n,r,s)},clear:function(t,e,i,n){return this(t).clear(e,i,n)},remove:function(t,e,i,n,r){return this(t).remove(e,i,n,r)},config:function(t,e,i){if(e===p){var n=typeof t;if("string"===n)return this._configs[t];if("object"===n)for(var r in t)this._configs[r.toLowerCase()]=t[r];else if("function"===n||"undefined"===n){var s=this;return o(null,{url:"/settings",process:function(t){return s.config(t),t}},t,e,i)}}else this._configs[t.toLowerCase()]=e},status:function(t,e,i){var n=this;return"function"!=typeof e&&(i||(i=e),e=null),o(this._configs,{url:"auth.hoi.io/status",process:function(t){return n._user=t,t},processError:function(t){return n._user=null,t}},t,e,i)},signup:function(t,e,i,n){var r=this;return"object"==typeof t?o(this._configs,{url:"auth.hoi.io/user",data:t,process:function(t){return t.redirectUrl&&(window.location=t.redirectUrl),r._user=t,t}},e,i,n):void 0},login:function(t,e,i,n){var r=this;return"object"==typeof t?o(this._configs,{url:"auth.hoi.io/login",data:t,process:function(t){return t.redirectUrl&&(window.location=t.redirectUrl),r._user=t,t}},e,i,n):void 0},logout:function(t,e,i){var n=this;return o(this._configs,{url:"auth.hoi.io/logout",method:"POST",process:function(t){return n._user=null,n._bucket=null,t}},t,e,i)},accept:function(t,e,i,n,r){var s=this;return o(this._configs,{url:"auth.hoi.io/invite/"+t+"/user",data:e,process:function(t){return s._user=t,t}},i,n,r)},user:function(){return this._user&&t({},this._user)},notify:function(t,e,i,n,s){return"object"==typeof t&&(s=n,n=i,i=e,e=t.data,t=t.id),"object"==typeof e?o(this._configs,{url:"notify.hoi.io/notification/"+t,data:e},i,n,s):r(n,s,"data for notification must be an object")},file:function(t,e,i,s,u){e.jquery&&(e=e[0]);var c,h=n(e);if("File"===h)c=new FormData,c.append("file",e);else if("FormData"===h)c=e;else{if("HTMLInputElement"!==h)return"Function"===h?(u=s,s=i,i=e,o(this._configs,{url:"file.hoi.io/"+t,responseType:"blob"},i,s,u)):"Undefined"===h?o(this._configs,{url:"file.hoi.io/"+t,responseType:"blob"},i,s,u):r(s,u,"can't send file of type "+h);if(e=e.files&&e.files[0],!e)return!1;c=new FormData,c.append("file",e)}return o(this._configs,{url:"file.hoi.io/"+t,data:c},i,s,u)},use:function(e){var i=this,r=t(function(t){return"Object"===n(t)?new f(r,t):new u(i,t,e)},m);return r.hoist=this,r.bucket=e,r},connector:function(t,e){return new a(this,t,e)},clone:function(){var e=t(l(),{_configs:t({},this._configs),_user:null,_bucket:null,_managers:{}});return e}},g={status:function(t,e,i){var n=this._hoist;return"function"!=typeof e&&(i||(i=e),e=null),o(this._hoist._configs,{url:"auth.hoi.io/bucket/current",process:function(t){return n._bucket=t,t},processError:function(t){return n._bucket=null,t}},t,e,i)},post:function(t,e,i,n,r){return"string"!=typeof t&&null!==t&&(r=n,n=i,i=e,e=t,t=null),"function"==typeof e&&(r=n,n=i,i=e,e=null),t?o(this._hoist._configs,{url:"auth.hoi.io/bucket/"+t,data:e},i,n,r):o(this._hoist._configs,{url:"auth.hoi.io/bucket",data:e},i,n,r)},meta:function(t,e,i,n,s){var u=this._hoist;if("string"!=typeof t){if(s=n,n=i,i=e,e=t,!u._bucket)return r(n,s,"No bucket to post metadata against",null);t=u._bucket.key}return o(u._configs,{url:"auth.hoi.io/bucket/"+t+"/meta",data:e,process:function(t){return u._bucket&&u._bucket.key==t.key&&(u._bucket=t),t}},i,n,s)},set:function(t,e,i,n){var r=this._hoist;return o(this._hoist._configs,{url:"auth.hoi.io/bucket/current/"+(t||"default"),method:"POST",process:function(e){return r._bucket=t?e:null,e}},e,i,n)},list:function(t,e,i){return o(this._hoist._configs,{url:"auth.hoi.io/buckets"},t,e,i)},invite:function(t,e,i,n,r){return"object"==typeof t&&(r=n,n=i,i=e,e=t,t=null),t&&(e=_.extend({bucket:t},e)),o(this._hoist._configs,{url:"auth.hoi.io/invite",data:e},i,n,r)}};t(a.prototype,{authorize:function(e,i){var n=this;return e=t({url:window.location.href,error:function(){},success:function(){},redirect:function(t){window.location=t}},e),o(this.hoist._configs,{url:this.url+"/connect",data:{return_url:e.url}},function(t){return t.token&&(n.token=t.token),t.redirect?void(e.redirect&&e.redirect.apply(this,[t.redirect])):void(e.success&&e.success.apply(this,arguments))},e.error,i)},get:function(t,e,i,n){return"/"!==t[0]&&(t="/"+t),o(this.hoist._configs,{url:this.url+t,token:this.token},e,i,n)},post:function(t,e,i,n,r){return"/"!==t[0]&&(t="/"+t),o(this.hoist._configs,{url:this.url+t,data:e,token:this.token},i,n,r)},put:function(t,e,i,n,r){return"/"!==t[0]&&(t="/"+t),o(this.hoist._configs,{url:this.url+t,data:e,method:"PUT",token:this.token},i,n,r)},remove:function(t,e,i,n,r){return"function"==typeof e&&(r=n,n=i,i=e,e=null),"/"!==t[0]&&(t="/"+t),o(this.hoist._configs,{url:this.url+t,data:e,method:"DELETE",token:this.token},i,n,r)}});var v=t(l(),{_configs:{protocol:"https://"},_user:null,_bucket:null,_managers:{}});"function"==typeof define&&define.amd?define("Hoist",[],function(){return v}):"object"==typeof window&&"object"==typeof window.document?window.Hoist=v:"object"==typeof module&&"object"==typeof module.exports&&(module.exports=v)}()}();
//# sourceMappingURL=hoist-min.js.map